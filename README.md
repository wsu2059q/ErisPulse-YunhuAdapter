# âš ï¸ æœ¬ä»“åº“å·²å½’æ¡£ï¼ä¸»è¦ç»´æŠ¤è€…å·²é€€å‡ºäº‘æ¹–å¹³å° âš ï¸

> **é‡è¦è¯´æ˜ï¼š**
>
> æœ¬é¡¹ç›®å·²äº 2025 å¹´ 5 æœˆ å½’æ¡£ï¼Œä¸»è¦ç»´æŠ¤è€…å·²é€€å‡ºäº‘æ¹–å¹³å°ã€‚æœªæ¥æœ¬ä»“åº“å°†ä¸å†é€‚é…äº‘æ¹–åè®®çš„æ–°ç‰¹æ€§ï¼Œä¹Ÿä¸ä¼šå“åº” issue æˆ– PRã€‚**è¯·è°¨æ…ç”¨äºç”Ÿäº§ç¯å¢ƒï¼**
>
> äº‘æ¹–å¹³å°æœ¬èº«ä»åœ¨è¿è¥ï¼Œä½†æˆ‘ä»¬ä½œä¸ºä¸€ç¾¤å¼€å‘è€…ï¼Œå› ç”Ÿæ€ç¯å¢ƒã€ç¤¾åŒºæ°›å›´ç­‰å¤šæ–¹é¢åŸå› ï¼Œé€‰æ‹©ç¦»å¼€ã€‚æˆ‘ä»¬å¸Œæœ›ç¤¾åŒºèƒ½æŒç»­å…³æ³¨ Bot ç”Ÿæ€çš„å¥åº·å‘å±•ã€‚

---

## ä¸ºä»€ä¹ˆå½’æ¡£ï¼Ÿæˆ‘ä»¬æƒ³è¯´äº›ä»€ä¹ˆ

- **ç”Ÿæ€æ··ä¹±ï¼Œç¼ºä¹æœ‰æ•ˆæ²»ç†**  
  äº‘æ¹– Bot ç”Ÿæ€é•¿æœŸå­˜åœ¨è´¨é‡å‚å·®ä¸é½ã€æ»¥ç”¨æ¥å£ç­‰é—®é¢˜ã€‚å³ä¾¿åœ¨å…¨å‘˜ç¾¤ï¼Œéƒ¨åˆ†ç®¡ç†äººå‘˜ä¹Ÿæœªèƒ½ç§¯æç»´æŠ¤å¥åº·ç”Ÿæ€ï¼Œç”šè‡³åœ¨é¢å¯¹å¼€å‘è€…æå‡ºçš„è°´è´£æ—¶ï¼Œé€‰æ‹©â€œæ¯”çƒ‚â€è€Œéæ¨åŠ¨æ”¹è¿›ã€‚
- **å¼€å‘è€…ç´ è´¨å‚å·®**  
  éƒ¨åˆ† Bot å¼€å‘è€…åŸºç¡€èƒ½åŠ›ä¸è¶³ï¼Œä»£ç ä¸­å¸¸è§å¦‚æœªæ­£ç¡®åŒºåˆ† `/` å¼€å¤´çš„æŒ‡ä»¤ä¸æ™®é€šæ¶ˆæ¯ã€æœªåˆ¤æ–­ `eventType` ç­‰ä½çº§é”™è¯¯ï¼Œå½±å“äº†å¹³å°æ•´ä½“ä½“éªŒã€‚
- **æˆ‘ä»¬å¸Œæœ›çš„ç¤¾åŒºæ°›å›´**  
  æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªé¼“åŠ±é«˜è´¨é‡å¼€å‘ã€å…±åŒç»´æŠ¤ç”Ÿæ€ã€äº’ç›¸å­¦ä¹ è¿›æ­¥çš„ç¤¾åŒºï¼Œè€Œä¸æ˜¯æ¨å¸è´£ä»»ã€äº’ç›¸æŒ‡è´£ã€æ”¾ä»»ä½è´¨é‡ä»£ç æ³›æ»¥çš„ç¯å¢ƒã€‚

---

## ä¸‹é¢æ˜¯åŸæœ‰æ–‡æ¡£å†…å®¹

ï¼ˆä»¥ä¸‹ä¸ºåŸæœ‰ YunhuAdapter è¯´æ˜æ–‡æ¡£ï¼Œä¾›æœ‰éœ€è¦çš„å¼€å‘è€…å‚è€ƒï¼‰

---

# YunhuAdapter - äº‘æ¹–åè®®é€‚é…å™¨

## æ¨¡å—ä»‹ç»

### YunhuAdapter
æä¾›å¼‚æ­¥ HTTP æœåŠ¡ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªäº‘æ¹– App çš„ Webhook æ¨é€äº‹ä»¶ã€‚é€‚ç”¨äºäº‘æ¹–å¼€æ”¾å¹³å°çš„æ¶ˆæ¯å›è°ƒæœºåˆ¶ã€‚

#### ä¸»è¦åŠŸèƒ½ï¼š
- æ”¯æŒé…ç½®ç›‘å¬åœ°å€ã€ç«¯å£å’Œå›è°ƒè·¯å¾„
- æä¾›ç»Ÿä¸€çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Œå°†ä¸åŒäº‹ä»¶ç±»å‹è½¬å‘ç»™å¯¹åº”çš„å¤„ç†å™¨

---

## ä½¿ç”¨ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´ä½¿ç”¨ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åˆå§‹åŒ– SDK å¹¶æ³¨å†Œå„ç±»äº‹ä»¶å¤„ç†å™¨ï¼š

```python
import asyncio
from ErisPulse import sdk

# åˆå§‹åŒ–SDK
sdk.init()

async def on_followed(data):
    print(f"è¢«ç”¨æˆ·å…³æ³¨å•¦: {data}")

async def on_unfollowed(data):
    print(f"è¢«ç”¨æˆ·å–å…³äº† T_T: {data}")

async def on_command(data):
    print(f"æ”¶åˆ°é€šç”¨æŒ‡ä»¤: {data}")

# æŒ‡ä»¤å¤„ç†å‡½æ•°ï¼ˆæŒ‡å®š cmdidï¼‰
async def handle_start(data):
    print(f"æ”¶åˆ°æŒ‡ä»¤ START: {data}")

async def handle_stop(data):
    print(f"æ”¶åˆ°æŒ‡ä»¤ STOP: {data}")

async def main():
    # æ·»åŠ è§¦å‘å™¨
    sdk.YunhuAdapter.AddTrigger(sdk.YunhuBotFollowed)           # æ³¨å†Œå…³æ³¨äº‹ä»¶
    sdk.YunhuAdapter.AddTrigger(sdk.YunhuBotUnfollowed)         # æ³¨å†Œå–æ¶ˆå…³æ³¨äº‹ä»¶
    sdk.YunhuAdapter.AddTrigger(sdk.YunhuCommandHandler)        # æ³¨å†ŒæŒ‡ä»¤æ¶ˆæ¯è§¦å‘å™¨

    # æ·»åŠ å…·ä½“å¤„ç†å™¨
    sdk.YunhuBotFollowed.AddHandle(on_followed)
    sdk.YunhuBotUnfollowed.AddHandle(on_unfollowed)
    sdk.YunhuCommandHandler.AddHandle(on_command)

    # æ·»åŠ å¸¦æŒ‡ä»¤IDçš„å¤„ç†å™¨
    sdk.YunhuCommandHandler.AddHandle(handle_start, "114")
    sdk.YunhuCommandHandler.AddHandle(handle_stop, "514")

    # å¯åŠ¨ Webhook æœåŠ¡
    await sdk.YunhuAdapter.Run()

# è¿è¡Œä¸»ç¨‹åº
asyncio.run(main())
```

---

## é…ç½®è¯´æ˜

åœ¨ `config.py` ä¸­è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

```python
from ErisPulse import sdk

sdk.env.set('YunhuAdapter',{
    "Server":{
        "host": "127.0.0.1",
        "port": 8080,
        "path": "/"
    },
    "token": ""
})
```

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `host` | string | Webhook æœåŠ¡ç›‘å¬çš„ä¸»æœºåœ°å€ |
| `port` | int | ç›‘å¬ç«¯å£å· |
| `path` | string | Webhook å›è°ƒè·¯å¾„ |
| `token` | string | å¯é€‰ï¼Œç”¨äºæ ¡éªŒè¯·æ±‚æ¥æºåˆæ³•æ€§ |

---
## è£…é¥°å™¨æ–¹å¼ç›‘å¬äº‹ä»¶ï¼ˆv1.2.0+ æ–°å¢ï¼‰

è‡ª `YunhuAdapter v1.2.0` èµ·ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¿«é€Ÿç›‘å¬äº‹ä»¶ï¼š

```python
@sdk.YunhuAdapter.on("bot.followed")
async def on_followed(data):
    print("æœ‰ç”¨æˆ·å…³æ³¨äº†æœºå™¨äºº:", data)

@sdk.YunhuAdapter.on("message.receive.instruction").id("114514")
async def handle_calculator_a(data):
    print("ç”¨æˆ·è¾“å…¥äº†idä¸º 114514 çš„å‘½ä»¤:", data)

@sdk.YunhuAdapter.on("message.receive.instruction").name("è®¡ç®—å™¨")
async def handle_calculator_b(data):
    print("ç”¨æˆ·è¾“å…¥äº†åç§°ä¸º è®¡ç®—å™¨ çš„å‘½ä»¤:", data)
```

è¯¥æ–¹å¼è¯­æ³•ç®€æ´ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘æˆ–å°å‹è„šæœ¬ã€‚

---

## æ¨¡å—åŒ–äº‹ä»¶å¤„ç†ï¼ˆæ¨èï¼‰

å°½ç®¡è£…é¥°å™¨æ–¹å¼éå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä»ç„¶å»ºè®®ä½¿ç”¨ç‹¬ç«‹æ¨¡å—è¿›è¡Œäº‹ä»¶å¤„ç†ï¼ŒåŸå› åŒ…æ‹¬ï¼š

- æ›´å¥½çš„èŒè´£åˆ†ç¦»ä¸ä»£ç ç»„ç»‡
- æ”¯æŒå¤šå¤„ç†å™¨ã€åˆ†ç±»å¤„ç†ï¼ˆå¦‚ `.AddHandle(handler)`ï¼‰
- æ’ä»¶ç³»ç»Ÿå…¼å®¹æ€§æ›´å¥½
- æ—¥å¿—æ›´æ¸…æ™°ï¼Œä¾¿äºè°ƒè¯•ç»´æŠ¤
- æ›´æ˜“æ‰©å±•æœªæ¥åŠŸèƒ½ï¼ˆæƒé™æ§åˆ¶ã€ä¸­é—´ä»¶ç­‰ï¼‰

---

## ğŸ“¬ æ”¯æŒçš„äº‹ä»¶ç±»å‹

| æ¨¡å—å              | äº‹ä»¶ç±»å‹         | åŠŸèƒ½æè¿°                           |
|---------------------|------------------|------------------------------------|
| `YunhuBotFollowed`       | `bot.followed`           | å¤„ç†ç”¨æˆ·å…³æ³¨æœºå™¨äººäº‹ä»¶               |
| `YunhuBotUnfollowed`     | `bot.unfollowed`         | å¤„ç†ç”¨æˆ·å–æ¶ˆå…³æ³¨æœºå™¨äººäº‹ä»¶             |
| `YunhuCommandHandler`    | `message.receive.instruction` | å¤„ç†å¸¦æœ‰æŒ‡ä»¤ ID çš„æ¶ˆæ¯äº‹ä»¶             |
| `YunhuNormalHandler`     | `message.receive.normal` | å¤„ç†æ™®é€šæ–‡æœ¬/å¯Œæ–‡æœ¬æ¶ˆæ¯               |
| `YunhuGroupJoin`         | `group.join`             | å¤„ç†ç”¨æˆ·åŠ å…¥ç¾¤èŠäº‹ä»¶                 |
| `YunhuGroupLeave`        | `group.leave`            | å¤„ç†ç”¨æˆ·é€€å‡ºç¾¤èŠäº‹ä»¶                 |

### AddHandle çš„é€šç”¨ä½¿ç”¨æ–¹æ³•ï¼š
```python
sdk.<Module>.AddHandle(handle)
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `handle` | async function | âœ… | å¼‚æ­¥å¤„ç†å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•° `data`ï¼ˆå³äº‹ä»¶æ•°æ®ï¼‰ |

## YunhuCommandHandler ç‰¹åˆ«è¯´æ˜

`YunhuCommandHandler` æ˜¯å¤„ç†å¸¦æœ‰æŒ‡ä»¤ ID çš„å‘½ä»¤ç±»æ¶ˆæ¯çš„ä¸“ç”¨æ¨¡å—ï¼Œæ”¯æŒæŒ‰ `instructionId` æˆ– `commandId` åˆ†ç±»å¤„ç†ã€‚

ç‰¹åˆ«çš„ YunhuCommandHandler çš„ AddHandle æ–¹æ³•æ”¯æŒä¼ å…¥ `cmdid` ä»¥è·å–æŒ‡å®šæŒ‡ä»¤ ID çš„å¤„ç†å›è°ƒ
```python
sdk.YunhuCommandHandler.AddHandle(handle, cmdid="ALL")
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `handle` | async function | âœ… | å¼‚æ­¥å¤„ç†å‡½æ•°ï¼Œå‚æ•°ä¸ºæ¥æ”¶åˆ°çš„æ•°æ® `data` |
| `cmdid` | str | âŒ | è¦ç›‘å¬çš„æŒ‡ä»¤ IDï¼Œé»˜è®¤ `"ALL"` è¡¨ç¤ºæ‰€æœ‰æœªå•ç‹¬åŒ¹é…çš„æŒ‡ä»¤ |

---

## æ¶ˆæ¯å‘é€ä¸æ“ä½œæ¨¡å—

ä»¥ä¸‹æ¨¡å—æä¾›äº†å‘é€ä¸åŒç±»å‹æ¶ˆæ¯å’Œæ‰§è¡Œç›¸å…³æ“ä½œçš„åŠŸèƒ½ï¼š

| æ¨¡å—å            | åŠŸèƒ½è¯´æ˜                         |
|-------------------|----------------------------------|
| `YunhuMessageSender`   | å‘é€æ¶ˆæ¯                   |
| `YunhuMessageBatch`    | æ‰¹é‡å‘é€æ¶ˆæ¯                     |
| `YunhuMessageEditor`   | ç¼–è¾‘å·²å‘é€æ¶ˆæ¯                   |
| `YunhuMessageHistory`  | æŸ¥è¯¢å†å²æ¶ˆæ¯åŠæ’¤å›               |
| `YunhuMessageBoard`    | å‘å¸ƒçœ‹æ¿æ¶ˆæ¯ï¼ˆå«å…¨å±€å’Œå±€éƒ¨ï¼‰     |

### `YunhuMessageSender` æ¨¡å—
#### åŠŸèƒ½ï¼šå‘é€æ¶ˆæ¯ç»™ç”¨æˆ·æˆ–ç¾¤ç»„

##### ä¸»è¦æ–¹æ³•ï¼š
- `Text(recvId, recvType, content, buttons=[], parentId="")`
- `Markdown(recvId, recvType, content, buttons=[], parentId="")`
- `Html(recvId, recvType, content, buttons=[], parentId="")`
- `Image(recvId, recvType, content_bytes, buttons=[], parentId="")`
- `Video(recvId, recvType, content_bytes, buttons=[], parentId="")`
- `File(recvId, recvType, content_bytes, buttons=[], parentId="")`

##### ç¤ºä¾‹ï¼š
```python
await sdk.YunhuMessageSender.Text(
    recvId="user123",
    recvType="user",
    content="ä½ å¥½ï¼",
    buttons=[{"text": "ç‚¹å‡»æˆ‘", "value": "click"}]
)
```

---

### `YunhuMessageBatch` æ¨¡å—
#### åŠŸèƒ½ï¼šå‘å¤šä¸ªæ¥æ”¶è€…æ‰¹é‡å‘é€æ¶ˆæ¯

##### ä¸»è¦æ–¹æ³•ï¼š
- `Text(recvIds, recvType, content, buttons=[], parentId="")`
- `Markdown(recvIds, recvType, content, buttons=[], parentId="")`
- `Html(recvIds, recvType, content, buttons=[], parentId="")`
- `Image(recvIds, recvType, content_bytes, buttons=[], parentId="")`
- `Video(recvIds, recvType, content_bytes, buttons=[], parentId="")`
- `File(recvIds, recvType, content_bytes, buttons=[], parentId="")`

##### ç¤ºä¾‹ï¼š
```python
await sdk.YunhuMessageBatch.Text(
    recvIds=["user1", "user2"],
    recvType="user",
    content="è¿™æ˜¯ä¸€æ¡æ‰¹é‡æ¶ˆæ¯"
)
```

---

### `YunhuMessageBoard` æ¨¡å—
#### åŠŸèƒ½ï¼šå‘å¸ƒæˆ–æ’¤é”€çœ‹æ¿æ¶ˆæ¯ï¼ˆæŒ‡å®šç”¨æˆ·ä¼šè¯çœ‹æ¿æˆ–å…¨å±€çœ‹æ¿ï¼‰

##### ä¸»è¦æ–¹æ³•ï¼š
- **æŒ‡å®šç”¨æˆ·çœ‹æ¿**
  - `LocalText(chatId, chatType, content, memberId="", expireTime=0)`
  - `LocalMarkdown(chatId, chatType, content, memberId="", expireTime=0)`
  - `LocalHtml(chatId, chatType, content, memberId="", expireTime=0)`
  - `LocalDismiss(chatId, chatType, memberId="")`

- **å…¨å±€çœ‹æ¿**
  - `GlobalText(content, expireTime=0)`
  - `GlobalMarkdown(content, expireTime=0)`
  - `GlobalHtml(content, expireTime=0)`
  - `GlobalDismiss()`

##### ç¤ºä¾‹ï¼š
```python
# å‘å¸ƒå…¨å±€æ–‡æœ¬çœ‹æ¿
await sdk.YunhuMessageBoard.GlobalText("è¿™æ˜¯å…¨å±€å…¬å‘Šï¼", expireTime=86400)

# æ’¤é”€æŸä¸ªç”¨æˆ·çš„å±€éƒ¨çœ‹æ¿
await sdk.YunhuMessageBoard.LocalDismiss(chatId="group123", chatType="group", memberId="user1")
```

---

### `YunhuMessageEditor` æ¨¡å—
#### åŠŸèƒ½ï¼šç¼–è¾‘å·²å‘é€çš„æ¶ˆæ¯å†…å®¹ï¼ˆæ”¯æŒæ–‡æœ¬/Markdownï¼‰

##### ä¸»è¦æ–¹æ³•ï¼š
- `Text(msgId, recvId, recvType, content, buttons=[])`
- `Markdown(msgId, recvId, recvType, content, buttons=[])`

##### ç¤ºä¾‹ï¼š
```python
await sdk.YunhuMessageEditor.Text(
    msgId="msg_abc123",
    recvId="user123",
    recvType="user",
    content="ä¿®æ”¹åçš„æ¶ˆæ¯å†…å®¹"
)
```

---

### `YunhuMessageHistory` æ¨¡å—
#### åŠŸèƒ½ï¼šæ’¤å›æ¶ˆæ¯ & æŸ¥è¯¢å†å²æ¶ˆæ¯

##### ä¸»è¦æ–¹æ³•ï¼š
- `Recall(msgId, recvId, recvType)`
  > æ’¤å›æŸæ¡æ¶ˆæ¯
- `HistoryBefore(chatId, chatType, before, msgId=None)`
  > æŸ¥è¯¢åœ¨æŸä¸€æ—¶é—´ç‚¹ä¹‹å‰çš„å†å²æ¶ˆæ¯
- `HistoryAfter(chatId, chatType, msgId, after, before=None)`  
  > æŸ¥è¯¢æŸæ¡æ¶ˆæ¯ä¹‹åçš„å†å²æ¶ˆæ¯

##### ç¤ºä¾‹ï¼š
```python
# æ’¤å›ä¸€æ¡æ¶ˆæ¯
await sdk.YunhuMessageHistory.Recall(msgId="msg_abc123", recvId="user123", recvType="user")

# æŸ¥è¯¢æŸä¼šè¯å‰5æ¡å†å²æ¶ˆæ¯
result = await sdk.YunhuMessageHistory.HistoryBefore(chatId="group123", chatType="group", before=5)
```

---

## å‚è€ƒé“¾æ¥

- [ErisPulse ä¸»åº“](https://github.com/ErisPulse/ErisPulse/)
- [ErisPulse æ¨¡å—å¼€å‘æŒ‡å—](https://github.com/ErisPulse/ErisPulse/tree/main/docs/DEVELOPMENT.md)
- [äº‘æ¹–å®˜æ–¹ API æ–‡æ¡£](https://www.yhchat.com/document/1-3)
